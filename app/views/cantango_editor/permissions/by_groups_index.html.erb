<%= javascript_include_tag "cantango_editor/jquery.ui/jquery.ui.core.js" %>
<%= javascript_include_tag "cantango_editor/jquery.ui/jquery.ui.widget.js" %>
<%= javascript_include_tag "cantango_editor/jquery.ui/jquery.ui.position.js" %>
<%= javascript_include_tag "cantango_editor/jquery.ui/jquery.ui.selectmenu.js" %>


<h1>Permissions</h1>
<%= render :partial => 'by_nav' %>
<hr/>

<!-- CantangoEditor::Permissions.yml_file_content %-->

<%= form_tag permissions_path, :remote => true, :method => :post do %>
  <%= submit_tag %>

<% @permissions_types.each do |ptype| %>

  <% content_tag :h2, :style => "text-align:center" do %>
    <%= ptype %>
  <% end %>

  <table>
    <th class="permissions_type">
      <%= ptype %>
    </th>
    <% @permissions_groups[ptype].each do |pgroup| %>
      <tr>
        <td colspan="4" style="font-size:18px;color:green;" ><%= pgroup %></td><!--td></td><td></td><td></td-->
      </tr>    
      <th></th> <th></th>  <th>can </th>  <th>cannot</th>
      <% @actions.each do |crud_action| %> 
      <tr> 
        <td> </td>
        <td style="color:grey"> <%= crud_action %> </td> 
        <% [:can, :cannot].each do |can_action| %>
        <td style="width:350px;"> 
          <% (targets = @permissions[ptype][pgroup][can_action][crud_action]).each do |model| %>
            <%= model %>
            &nbsp; 
            <small>- more options -</small>
            <span class="delete_target_section">
              <%= hidden_field_tag "delete_target_field", model, :class => "delete_target_field", :name => "delete_permissions[#{ptype}][#{pgroup}][#{can_action}][#{crud_action}][]", :disabled => "disabled" %>
              <%= link_to "x", "##", :class => "delete_target_link" %>
            </span>
           <br/>
          <% end %>
          <div id="new_target_area"></div>  
          <%= link_to "+", new_target_permissions_path(:ptype => ptype, :pgroup => pgroup, :can_action => can_action, :crud_action => crud_action, :existing_targets => targets), :remote => true, :class => "new_target_link" %>
        </td>
        <% end %>
      </tr>
      <% end %>
      <tr><td colspan="4" style=""></td></tr>
    <% end %>
  </table>
<% end %>

<% end %>
<hr/>
<%= link_to "Main page", main_app.root_path %>
